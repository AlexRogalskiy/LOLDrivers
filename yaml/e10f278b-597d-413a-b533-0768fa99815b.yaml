Id: e10f278b-597d-413a-b533-0768fa99815b
Author: Michael Haag
Created: '2023-05-22'
MitreID: T1068
Category: vulnerable driver
Verified: 'TRUE'
Commands:
  Command: sc.exe create procexp1627.sys binPath=C:\windows\temp\procexp1627.sys type=kernel
    && sc.exe start procexp1627.sys
  Description: Vulnerable driver found in https://github.com/hfiref0x/KDU.
  Usecase: Elevate privileges
  Privileges: kernel
  OperatingSystem: Windows 10
Resources:
- https://github.com/magicsword-io/LOLDrivers/issues/55#issuecomment-1537161951
Acknowledgement:
  Person: hfiref0x
  Handle: hfiref0x
Detection: []
KnownVulnerableSamples:
- Filename: procexp1627.sys
  MD5: c06dda757b92e79540551efd00b99d4b
  SHA1: 3296844d22c87dd5eba3aa378a8242b41d59db7a
  SHA256: 9b6a84f7c40ea51c38cc4d2e93efb3375e9d98d4894a85941190d94fbe73a4e4
  Signature: ''
  Date: ''
  Publisher: ''
  Company: Sysinternals - www.sysinternals.com
  Description: Process Explorer
  Product: Process Explorer
  ProductVersion: '16.27'
  FileVersion: '16.27'
  MachineType: AMD64
  OriginalFilename: procexp.Sys
  Authentihash:
    MD5: f57e986673aee44bf51e7e6bb3ed0113
    SHA1: edc10781eb6d1e3bdf9d15cfebddbe1a1fb804d9
    SHA256: decba65bbf2232ac55a698539304cab211b45eef0ed17c05dd7995bef2b98fc6
  InternalName: procexp.sys
  Copyright: Copyright (C) Mark Russinovich 1996-2019
  Imports:
  - ntoskrnl.exe
  ExportedFunctions: ''
  ImportedFunctions:
  - strncpy
  - RtlInitUnicodeString
  - RtlUnicodeStringToAnsiString
  - RtlFreeAnsiString
  - KeWaitForSingleObject
  - ExAllocatePoolWithTag
  - ExFreePoolWithTag
  - ExGetPreviousMode
  - MmGetSystemRoutineAddress
  - SeCaptureSubjectContext
  - SeReleaseSubjectContext
  - IofCompleteRequest
  - IoCreateSymbolicLink
  - IoDeleteDevice
  - IoDeleteSymbolicLink
  - ObReferenceObjectByHandle
  - ObfDereferenceObject
  - ZwClose
  - MmIsAddressValid
  - PsGetVersion
  - ZwOpenProcess
  - KeStackAttachProcess
  - KeUnstackDetachProcess
  - SePrivilegeCheck
  - PsLookupProcessByProcessId
  - ObOpenObjectByPointer
  - ObQueryNameString
  - ZwQueryObject
  - ZwDuplicateObject
  - ZwOpenProcessToken
  - ZwQueryInformationProcess
  - ZwQuerySystemInformation
  - ObCloseHandle
  - ObOpenObjectByName
  - __C_specific_handler
  - IoFileObjectType
  - PsProcessType
  - PsThreadType
  - RtlFreeUnicodeString
  - IoCreateDevice
  - ZwSetSecurityObject
  - IoDeviceObjectType
  - _snwprintf
  - RtlLengthSecurityDescriptor
  - SeCaptureSecurityDescriptor
  - RtlCreateSecurityDescriptor
  - RtlSetDaclSecurityDescriptor
  - RtlAbsoluteToSelfRelativeSD
  - IoIsWdmVersionAvailable
  - SeExports
  - wcschr
  - _wcsnicmp
  - RtlLengthSid
  - RtlAddAccessAllowedAce
  - RtlGetSaclSecurityDescriptor
  - RtlGetDaclSecurityDescriptor
  - RtlGetGroupSecurityDescriptor
  - RtlGetOwnerSecurityDescriptor
  - ZwOpenKey
  - ZwCreateKey
  - ZwQueryValueKey
  - ZwSetValueKey
  - KeBugCheckEx
  Signatures:
  - CertificatesInfo: ''
    SignerInfo: ''
    Certificates:
    - Subject: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Hardware Compatibility Publisher
      ValidFrom: '2019-05-02 20:49:42'
      ValidTo: '2020-05-02 20:49:42'
      Signature: 9c38927cf34cadf6121bbacca605cb2423a311565e3a71c4449c2cb81936d3ed3aa79d7a0914e19ab121d788f1803cdf9f023a352823ad4175f5389c193fb1efba47e33ab8ff227e68742a875f3932dfa7bc39950353653e664de0049ba8f09914e5dd7d78dff13d50096d20de210e49c3ea01713741c88ed65805d4eb08ded809a5c70a116c7648c0c55951004b1d249575bed351fbee3361cf822e02b437c702c7948496eb784dbf6102839ceb3e1e26f344a6aa2a9b1b0b7c6f56f3c145cbecd9a9661adc7446b5c368f782f5fd50a5a244618ae30b3dc4616c59992a28192174906653bc878dec57075ce37a4e8ceeabd2b8eeff742443fee80af5ee6482
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
    - Subject: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Third Party Component CA 2012
      ValidFrom: '2012-04-18 23:48:38'
      ValidTo: '2027-04-18 23:58:38'
      Signature: 5a8a67daccd5fd0d264177bf0a4678b4b3de12692b7723c2652f015fd203f461ba509d2e8c3972f36c3e6ab11e766decb7f382dcccbbc56970287366173f54ebee011648c446d91b80ae813a8d0f796d68b09eea2d3f39d3ca387ebd5e7c086e19dcc6c2f438336861e2524783e1000156d2bacb878205310a418b4ee77f5f5fed5fd3392d45eba213bffd1ec298417161165fc80a70257c59693124e471e70abb0417f79f721ec9d2bb1abe3d02fe090cb243b4591a99539396215fe0d6b72601429536ac27fdbef48577683d18bdf4be98882211865216f345ec0397107087a37043713cdbc98603170cf5735bc67de15c64edd7c548d7ed32e2d1aad3cfa7f6574e61f977eb67f288b3de00da038fd08a34373e1dd862b8d2b1f3e12f8b723b81967c6ffcec667672601b24f2a0896d5b6d002eef28dd868705c2b4b9e5be64c22af24a155c98e2c42785ff52e3627e0fb2020bd766c70ab2d33d200414503259830a7d9bed5a38120152ba2f5e20728e4af1fde771028c3be107bec973f4dd47d8b4efb4a4b330b9893e76cab90098567eabea8ab8a5d038ab6977130b142fe9aa411ff7babd3a2b348aee0aab63e663f788248e200d2b3b9de3c24952ac9f1f0e393b5dd46e506ae67d523aaa7c3315290d265e0158a74ea93d7a846f743f609fe4324f3600af6d71d33ea646655f8174f1fec171da4ca0415a82ddf11f
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
    Signer:
    - SerialNumber: 3300000082c88ba15b1c3ef710000000000082
      Issuer: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Third Party Component CA 2012
Tags:
- procexp1627.sys
