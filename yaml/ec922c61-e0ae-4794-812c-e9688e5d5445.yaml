Id: ec922c61-e0ae-4794-812c-e9688e5d5445
Author: Michael Haag
Created: '2023-01-09'
MitreID: T1068
Category: vulnerable driver
Verified: 'TRUE'
Commands:
  Command: sc.exe create procexp.Sys binPath=C:\windows\temp\procexp.Sys type=kernel
    && sc.exe start procexp.Sys
  Description: "The method of abusing the Process Explorer driver to bypass EDR systems\
    \ isn\u2019t new; it was implemented in the open-source tool Backstab, first published\
    \ in June 2021. AuKill drops a driver named PROCEXP.SYS (from the release version\
    \ 16.32 of process Explorer) into the C:\\Windows\\System32\\drivers path. The\
    \ legitimate Process Explorer driver is named PROCEXP152.sys, and normally is\
    \ found in the same location."
  Usecase: Elevate privileges
  Privileges: kernel
  OperatingSystem: Windows 10
Resources:
- https://github.com/elastic/protections-artifacts/search?q=VulnDriver
- https://github.com/Yaxser/Backstab/blob/master/resources/PROCEXP.sys
- https://news.sophos.com/en-us/2023/04/19/aukill-edr-killer-malware-abuses-process-explorer-driver/
Acknowledgement:
  Person: ''
  Handle: ''
Detection: []
KnownVulnerableSamples:
- Filename: procexp.Sys
  MD5: 97e3a44ec4ae58c8cc38eefc613e950e
  SHA1: bc47e15537fa7c32dfefd23168d7e1741f8477ed
  SHA256: 440883cd9d6a76db5e53517d0ec7fe13d5a50d2f6a7f91ecfc863bc3490e4f5c
  Signature:
  - Microsoft Windows Hardware Compatibility Publisher
  - Microsoft Windows Third Party Component CA 2012
  - Microsoft Root Certificate Authority 2010
  Date: ''
  Publisher: ''
  Company: Sysinternals - www.sysinternals.com
  Description: Process Explorer
  Product: Process Explorer
  ProductVersion: '16.43'
  FileVersion: '16.43'
  MachineType: AMD64
  OriginalFilename: procexp.Sys
  Authentihash:
    MD5: 0a7106a04e6e3b13eb105b013f76e031
    SHA1: 0c74316dfb9c21b7ff2dc288c005f9474dc26589
    SHA256: c7fef94e329bd9b66b281539265f989313356cbd9c345df9e670e9c4b6e0edce
  InternalName: procexp.sys
  Copyright: Copyright (C) Mark Russinovich 1996-2021
  Imports:
  - ntoskrnl.exe
  ExportedFunctions: ''
  ImportedFunctions:
  - strncpy
  - RtlInitUnicodeString
  - RtlUnicodeStringToAnsiString
  - RtlFreeAnsiString
  - KeWaitForSingleObject
  - ExAllocatePoolWithTag
  - ExFreePoolWithTag
  - ExGetPreviousMode
  - MmGetSystemRoutineAddress
  - SeCaptureSubjectContext
  - SeReleaseSubjectContext
  - IofCompleteRequest
  - IoCreateSymbolicLink
  - IoDeleteDevice
  - IoDeleteSymbolicLink
  - ObReferenceObjectByHandle
  - ObfDereferenceObject
  - ZwClose
  - MmIsAddressValid
  - PsGetVersion
  - ZwOpenProcess
  - KeStackAttachProcess
  - KeUnstackDetachProcess
  - SePrivilegeCheck
  - PsLookupProcessByProcessId
  - ObOpenObjectByPointer
  - ObQueryNameString
  - ZwQueryObject
  - ZwDuplicateObject
  - ZwOpenProcessToken
  - ZwQueryInformationProcess
  - ZwQuerySystemInformation
  - ObCloseHandle
  - ObOpenObjectByName
  - __C_specific_handler
  - IoFileObjectType
  - PsProcessType
  - PsThreadType
  - RtlFreeUnicodeString
  - IoCreateDevice
  - ZwSetSecurityObject
  - IoDeviceObjectType
  - _snwprintf
  - RtlLengthSecurityDescriptor
  - SeCaptureSecurityDescriptor
  - RtlCreateSecurityDescriptor
  - RtlSetDaclSecurityDescriptor
  - RtlAbsoluteToSelfRelativeSD
  - IoIsWdmVersionAvailable
  - SeExports
  - wcschr
  - _wcsnicmp
  - RtlLengthSid
  - RtlAddAccessAllowedAce
  - RtlGetSaclSecurityDescriptor
  - RtlGetDaclSecurityDescriptor
  - RtlGetGroupSecurityDescriptor
  - RtlGetOwnerSecurityDescriptor
  - ZwOpenKey
  - ZwCreateKey
  - ZwQueryValueKey
  - ZwSetValueKey
  - KeBugCheckEx
  Signatures:
  - CertificatesInfo: ''
    SignerInfo: ''
    Certificates:
    - Subject: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Hardware Compatibility Publisher
      ValidFrom: '2020-12-15 22:15:30'
      ValidTo: '2021-12-02 22:15:30'
      Signature: 199acc6a8717c0db5b4b2312dccd8bb1e33ef492731fb8e1d60bd6f690de074b6d92293c8260012dcacc668a68f10e726a37d2ff7ee66b1eea424f56f104249bd6d7e7eba8c1745f4f1143bac7e648e48c1b2a1adf6954b5de1669df19c4be5633b791b7a3cba23641006fd58ac2d494a1d00dadbc3b3fe50a7ad0163cb386693824106b5dd9f9b8a579e45f5c5f8804832b8a773701e0ca31dee9a012fce5911492de93beea44a3822f7a83c448a484eeb937a4fa7f4067879b910e534c966d2650bd5c93f066656aa0f4c7c318161d4a8b367056df42af60a0aad0eb2de3bb47b96b948f2c849f330cfef599f1775bb6d41cf150decb40a83d5800727d977e
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
      IsCertificateAuthority: false
      SerialNumber: 33000000b20f9ad86794f322f60000000000b2
      Version: 3
      TBS:
        MD5: b9dc0ff1a60c3aba24a78d505955bf39
        SHA1: 15a5da2c8aa2955af75615009d249071f91fd252
        SHA256: ba7853f855ba7bc325287c11f5f7b20e013716affad372440feb2c3cf02f0bc5
    - Subject: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Third Party Component CA 2012
      ValidFrom: '2012-04-18 23:48:38'
      ValidTo: '2027-04-18 23:58:38'
      Signature: 5a8a67daccd5fd0d264177bf0a4678b4b3de12692b7723c2652f015fd203f461ba509d2e8c3972f36c3e6ab11e766decb7f382dcccbbc56970287366173f54ebee011648c446d91b80ae813a8d0f796d68b09eea2d3f39d3ca387ebd5e7c086e19dcc6c2f438336861e2524783e1000156d2bacb878205310a418b4ee77f5f5fed5fd3392d45eba213bffd1ec298417161165fc80a70257c59693124e471e70abb0417f79f721ec9d2bb1abe3d02fe090cb243b4591a99539396215fe0d6b72601429536ac27fdbef48577683d18bdf4be98882211865216f345ec0397107087a37043713cdbc98603170cf5735bc67de15c64edd7c548d7ed32e2d1aad3cfa7f6574e61f977eb67f288b3de00da038fd08a34373e1dd862b8d2b1f3e12f8b723b81967c6ffcec667672601b24f2a0896d5b6d002eef28dd868705c2b4b9e5be64c22af24a155c98e2c42785ff52e3627e0fb2020bd766c70ab2d33d200414503259830a7d9bed5a38120152ba2f5e20728e4af1fde771028c3be107bec973f4dd47d8b4efb4a4b330b9893e76cab90098567eabea8ab8a5d038ab6977130b142fe9aa411ff7babd3a2b348aee0aab63e663f788248e200d2b3b9de3c24952ac9f1f0e393b5dd46e506ae67d523aaa7c3315290d265e0158a74ea93d7a846f743f609fe4324f3600af6d71d33ea646655f8174f1fec171da4ca0415a82ddf11f
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
      IsCertificateAuthority: true
      SerialNumber: 610baac1000000000009
      Version: 3
      TBS:
        MD5: a569061297e8e824767dbc3184a69bea
        SHA1: adbb26a587a8f44b4fccaecb306f980d1c55a150
        SHA256: cec1afd0e310c55c1dcc601ab8e172917706aa32fb5eaf826813547fdf02dd46
    Signer:
    - SerialNumber: 33000000b20f9ad86794f322f60000000000b2
      Issuer: C=US, ST=Washington, L=Redmond, O=Microsoft Corporation, CN=Microsoft
        Windows Third Party Component CA 2012
      Version: 1
  RichPEHeaderHash:
    MD5: 10ece32f0d8e8124966ad20948a21790
    SHA1: e70413e4c5de0ddabaeb3b871f170e42cc2c98d3
    SHA256: 70581f2de67d48a583a4ee59062315c053f9419dc879e246c6a4efc9f1ec6506
  Sections:
    .text:
      Entropy: 6.135370257019049
      Virtual Size: '0x25d0'
    .rdata:
      Entropy: 4.304481785203618
      Virtual Size: '0xf90'
    .data:
      Entropy: 2.0732868843388097
      Virtual Size: '0x22c'
    .pdata:
      Entropy: 4.222974183202439
      Virtual Size: '0x2f4'
    PAGE:
      Entropy: 6.227798908894738
      Virtual Size: '0x1a1b'
    INIT:
      Entropy: 5.210944759781676
      Virtual Size: '0x818'
    .rsrc:
      Entropy: 3.3092987387252557
      Virtual Size: '0x380'
    .reloc:
      Entropy: 3.698934896284056
      Virtual Size: '0x30'
  MagicHeader: 50 45 0 0
  CreationTimestamp: '2021-08-16 20:01:16'
- Filename: procexp.sys
  MD5: b79475c4783efdd8122694c6b5669a79
  SHA1: d612165251d5f1dcfb1f1a762c88d956f49ce344
  SHA256: cdfbe62ef515546f1728189260d0bdf77167063b6dbb77f1db6ed8b61145a2bc
  Signature: ''
  Date: ''
  Publisher: ''
  Company: ''
  Description: ''
  Product: ''
  ProductVersion: ''
  FileVersion: ''
  MachineType: ''
  OriginalFilename: ''
Tags:
- procexp.Sys
